# ファイルマッピングアプリケーション

## 📖 概要

このアプリケーションは、ファイル（画像、動画、音声）をアップロードし、地図上で位置情報と共に管理できるDjangoベースのWebアプリケーションです。ユーザーは地図上でクリックして位置を選択でき、アップロードしたファイルを地理的な位置と共に保存・表示できます。

## ✨ 主な機能

### 🗺️ 地図機能
- **インタラクティブマップ**: Leaflet.jsを使用した日本地図
- **位置選択**: 地図上をクリックして位置を選択
- **住所自動取得**: 逆ジオコーディングで住所を自動取得
- **マーカー表示**: アップロードされたファイルの位置をマーカーで表示

### 📁 ファイル管理
- **多様なファイル形式対応**:
  - 画像ファイル (jpg, png, gif, etc.)
  - 動画ファイル (mp4, avi, mov, etc.)
  - 音声ファイル (mp3, wav, aac, etc.)
- **ファイルアップロード**: ドラッグ&ドロップまたはファイル選択
- **ファイル一覧表示**: アップロードされたファイルの詳細一覧
- **ファイルダウンロード**: アップロードされたファイルのダウンロード機能

### 📝 メタデータ管理
- **説明フィールド**: ファイルの説明を追加可能
- **アップロード日時**: 自動的に記録
- **位置情報**: 緯度・経度・住所を保存
- **ファイルタイプ**: 自動判定と表示

## 🛠️ 技術スタック

### バックエンド
- **Django 5.2.4**: Webフレームワーク
- **Python 3.x**: プログラミング言語
- **Pandas**: データ処理・CSV操作
- **Folium**: 地図生成

### フロントエンド
- **HTML5/CSS3**: マークアップ・スタイリング
- **JavaScript**: インタラクティブ機能
- **Leaflet.js**: 地図表示
- **Bootstrap**: UIフレームワーク

### 外部サービス
- **地理院タイル**: 日本地図タイル
- **Nominatim API**: 逆ジオコーディング（住所取得）

## 📋 必要要件

### システム要件
- Python 3.8以上
- pip（Pythonパッケージマネージャー）
- インターネット接続（地図表示・逆ジオコーディング用）

### 推奨環境
- Windows 10/11
- 4GB以上のRAM
- 1GB以上の空きディスク容量

## 🚀 インストール手順

### ローカル開発環境

#### 1. リポジトリのクローン
```bash
git clone [リポジトリURL]
cd file-mapping-app-main
```

#### 2. 仮想環境の作成とアクティベート
```bash
# Windows
python -m venv venv
venv\Scripts\activate

# macOS/Linux
python3 -m venv venv
source venv/bin/activate
```

#### 3. 依存関係のインストール
```bash
pip install -r requirements.txt
```

#### 4. データベースのマイグレーション
```bash
python manage.py makemigrations
python manage.py migrate
```

#### 5. 静的ファイルの収集
```bash
python manage.py collectstatic --noinput
```

#### 6. 開発サーバーの起動
```bash
python manage.py runserver 0.0.0.0:8000
```

#### 7. ブラウザでアクセス
```
http://localhost:8000
```

### Renderへのデプロイ

#### 1. Renderアカウントの作成
- [Render](https://render.com) にアクセスしてアカウントを作成
- GitHubアカウントでログインすることを推奨

#### 2. リポジトリの準備
- このプロジェクトをGitHubリポジトリにプッシュ
- 以下のファイルが含まれていることを確認：
  - `render.yaml`
  - `build.sh`
  - `requirements.txt`

#### 3. Renderでのデプロイ
1. Renderダッシュボードで「New +」をクリック
2. 「Blueprint」を選択
3. GitHubリポジトリを接続
4. `render.yaml`ファイルを自動検出
5. 「Apply」をクリックしてデプロイ開始

#### 4. 環境変数の設定
デプロイ後、以下の環境変数が自動的に設定されます：
- `SECRET_KEY`: 自動生成
- `DATABASE_URL`: Render PostgreSQLから自動設定
- `DEBUG`: False
- `ALLOWED_HOSTS`: .onrender.com

#### 5. アプリケーションの確認
- デプロイ完了後、提供されたURLでアプリケーションにアクセス
- データベースマイグレーションが自動実行される
- 静的ファイルが自動収集される

## 📁 プロジェクト構造

```
file-mapping-app-main/
├── archive_app/                 # メインアプリケーション
│   ├── data/                   # データファイル
│   │   └── uploaded_data.csv   # アップロードデータ
│   ├── static/                 # 静的ファイル
│   │   └── archive_app/
│   │       └── css/
│   │           └── style.css   # カスタムCSS
│   ├── templates/              # HTMLテンプレート
│   │   └── archive_app/
│   │       ├── index.html      # メインページ
│   │       └── file_list.html  # ファイル一覧ページ
│   ├── forms.py               # フォーム定義
│   ├── models.py              # データモデル
│   ├── services.py            # ビジネスロジック
│   ├── utils.py               # ユーティリティ関数
│   └── views.py               # ビュー関数
├── archive_project/            # Djangoプロジェクト設定
│   ├── settings.py            # プロジェクト設定
│   ├── urls.py                # URL設定
│   └── wsgi.py                # WSGI設定
├── media/                     # アップロードファイル保存先
├── staticfiles/               # 収集された静的ファイル
├── manage.py                  # Django管理スクリプト
├── requirements.txt           # Python依存関係
├── build.sh                   # Render用ビルドスクリプト
├── render.yaml                # Render設定ファイル
└── README.md                  # このファイル
```

## 🎯 使用方法

### ファイルのアップロード

1. **メインページにアクセス**
   - ブラウザで `http://localhost:8000` を開く

2. **ファイルを選択**
   - 「ファイルを選択」ボタンをクリック
   - またはファイルをドラッグ&ドロップ

3. **位置を選択**
   - 地図上をクリックして位置を選択
   - 住所が自動的に入力される

4. **説明を追加**（オプション）
   - ファイルの説明を入力

5. **アップロード**
   - 「アップロード」ボタンをクリック

### ファイルの閲覧

#### 地図上での閲覧
- メインページの地図上にマーカーが表示される
- マーカーをクリックするとファイルの詳細が表示される
- ファイルのプレビュー、ダウンロード、別タブでの表示が可能

#### ファイル一覧での閲覧
- ナビゲーションの「ファイル一覧」をクリック
- アップロードされたファイルの詳細一覧を表示
- ファイル名、種類、説明、住所、アップロード日時を確認可能

## 🔧 設定

### 環境変数（オプション）
```bash
# 開発環境
DEBUG=True
SECRET_KEY=your-secret-key

# 本番環境
DEBUG=False
SECRET_KEY=your-production-secret-key
```

### 地図設定
- **初期表示**: 日本の地理的中心
- **ズームレベル**: 5（初期値）
- **地図タイル**: 地理院タイル（標準地図）

### ファイル設定
- **最大ファイルサイズ**: 10MB
- **対応形式**: 画像、動画、音声ファイル
- **保存先**: `media/` ディレクトリ

## 🐛 トラブルシューティング

### よくある問題

#### 1. 地図が表示されない
- **原因**: インターネット接続の問題
- **解決策**: インターネット接続を確認

#### 2. ファイルアップロードエラー
- **原因**: ファイルサイズが大きすぎる
- **解決策**: 10MB以下のファイルを使用

#### 3. 住所が取得できない
- **原因**: 逆ジオコーディングAPIの制限
- **解決策**: しばらく待ってから再試行

#### 4. マーカーが表示されない
- **原因**: CSVファイルの構造エラー
- **解決策**: アプリケーションを再起動

### ログの確認
```bash
# 開発サーバーのログを確認
python manage.py runserver 0.0.0.0:8000
```

## 📊 データ管理

### CSVファイル構造
```csv
file_path,file_type,description,address,latitude,longitude,upload_date
```

### データのバックアップ
```bash
# CSVファイルのバックアップ
cp archive_app/data/uploaded_data.csv backup/
```

### データの復元
```bash
# CSVファイルの復元
cp backup/uploaded_data.csv archive_app/data/
```

## 🔒 セキュリティ

### 推奨事項
- 本番環境では `DEBUG=False` を設定
- 強力な `SECRET_KEY` を使用
- HTTPS通信を有効化
- ファイルアップロードの制限を設定

### 注意事項
- このアプリケーションは開発・学習用途です
- 本番環境での使用には追加のセキュリティ対策が必要です

## 🤝 貢献

### バグ報告
- GitHubのIssuesでバグを報告
- 再現手順を詳細に記載

### 機能要望
- GitHubのIssuesで機能要望を提案
- 使用例やメリットを説明

### プルリクエスト
- フォークしてブランチを作成
- 変更内容を明確に説明
- テストを実行してからプルリクエスト

## 📄 ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 📞 サポート

### 質問・相談
- GitHubのIssuesで質問
- 詳細な情報を提供

### ドキュメント
- このREADMEファイル
- コード内のコメント
- Django公式ドキュメント

## 🔄 更新履歴

### v1.0.0 (2025-07-15)
- 初回リリース
- 基本的なファイルアップロード機能
- 地図上での位置選択機能
- ファイル一覧表示機能

## 🙏 謝辞

- **Django**: Webフレームワーク
- **Leaflet.js**: 地図表示ライブラリ
- **地理院**: 地図タイル提供
- **OpenStreetMap**: 地理データ提供

---

**注意**: このアプリケーションは教育・学習目的で作成されています。本番環境での使用には十分なテストとセキュリティ対策が必要です。 